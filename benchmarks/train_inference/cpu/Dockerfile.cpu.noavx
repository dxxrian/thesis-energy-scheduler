# Dockerfile.cpu.noavx
FROM python:3.8-slim

WORKDIR /app

# System dependencies
RUN apt-get update && apt-get install -y --no-install-recommends libgomp1 \
    && rm -rf /var/lib/apt/lists/*

# Copy Script & Wheel
COPY cpu-task.py .
COPY tensorflow-2.3.0-cp38-cp38-linux_x86_64.whl /tmp/

# Install No-AVX Tensorflow
RUN pip install --no-cache-dir \
    /tmp/tensorflow-2.3.0-cp38-cp38-linux_x86_64.whl \
    "protobuf<=3.20.3"

ENTRYPOINT ["python", "cpu-task.py"]
