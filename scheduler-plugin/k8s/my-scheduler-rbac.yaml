apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-energy-scheduler-sa
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: my-energy-scheduler-role
rules:
  # Erlaubt das Erstellen von Events
  - apiGroups: ["", "events.k8s.io"]
    resources: ["events"]
    verbs: ["create", "patch", "update"]
  # Erlaubt die Leader Election für Hochverfügbarkeit
  - apiGroups: ["coordination.k8s.io"]
    resources: ["leases"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  # Die Kern-Berechtigungen zum Binden von Pods an Nodes
  - apiGroups: [""]
    resources: ["pods/binding"]
    verbs: ["create"]
  # Erlaubt das Aktualisieren des Pod-Status
  - apiGroups: [""]
    resources: ["pods/status"]
    verbs: ["patch", "update"]
  # Erlaubt das Lesen aller wichtigen Ressourcen für Scheduling-Entscheidungen
  - apiGroups: ["", "apps", "policy", "storage.k8s.io"]
    resources:
      - "nodes"
      - "pods"
      - "services"
      - "replicationcontrollers"
      - "persistentvolumes"
      - "persistentvolumeclaims"
      - "replicasets"
      - "statefulsets"
      - "poddisruptionbudgets"
      - "storageclasses"
      - "csinodes"
      - "csidrivers"
      - "csistoragecapacities"
      - "namespaces"
      - "configmaps"
    verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-energy-scheduler-binding
subjects:
- kind: ServiceAccount
  name: my-energy-scheduler-sa
  namespace: kube-system
roleRef:
  kind: ClusterRole
  name: my-energy-scheduler-role
  apiGroup: rbac.authorization.k8s.io
